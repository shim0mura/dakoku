#!/usr/bin/env ruby

require 'readline'

USAGE <<-HELP
  USAGE dakoku [options] what are you doing
  -h (--help)   show this help
  -l (--list)   show your journal of the selected day
  -a (--amend)  amend your journal of the selected line
  -c (--config) change reminder settings
HELP

unless ARGV
  puts "USAGE dakoku things what are you doing now"
  exit!
end

dakoku = Dakoku.new

case ARGV[0]
when "-h", "--help"
  puts USAGE
when "-l", "--list"
  dakoku.list
else
  dakoku.journal
end

$LOAD_PATH.unshift File.expand_path("../lib", File.dirname(__FILE__))

# Dakoku
# -Journal
# -Reminder
# (-API)
#

class Dakoku
  def initialize(arg)
    @doing = arg
    @file = nil
  end

  def dakoku
    set_file
    @file.write @doing
    @file.close
  end

  def list
    counter = 0
    file_list = Dir.glob("*")
    puts_lists(file_list)
    puts "select line number you want to show."
    begin
      while select = Readline.readline("line? > ", false)
        #next unless select.valid_selector?
      end
    rescue
      exit!
    end      
    set_file(filelist[select])
    put_lists(@file)
  end

  private
  def set_file(filename = Time.now.strftime("%Y%m%d"))
    @file = open("/home/shimomura/work/time-analytics/dakoku/#{filename}.dat", "a")
  end

  def put_lists(lists)
    counter = 0
    lists do |line|
      put "#{counter}: " + line
    end
  end

end
